<html>
  <head>
    <title>Coverage report for Bisect_ppx</title>
    <link rel="stylesheet" href="style.css" />
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="index.html">
          <span class="dirname">src/syntax/</span>instrumentPpx.ml
        </a>
      </h1>
      <h2>99.37%</h2>
    </div>
    <div id="navbar">
      <span class="some-visited" style="top:31.46%"></span>
      <span class="unvisited" style="top:42.69%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span > </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span > </span>
<a id="L25"></a><span class="visited"> </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span class="visited"> </span>
<a id="L28"></a><span class="visited"> </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span class="visited"> </span>
<a id="L32"></a><span class="visited"> </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span class="visited"> </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span class="visited"> </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span class="visited"> </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span class="visited"> </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span class="visited"> </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span class="visited"> </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span > </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span > </span>
<a id="L54"></a><span class="visited"> </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span > </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span class="visited"> </span>
<a id="L61"></a><span > </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span class="visited"> </span>
<a id="L64"></a><span class="visited"> </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span class="visited"> </span>
<a id="L69"></a><span class="visited"> </span>
<a id="L70"></a><span class="visited"> </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span class="visited"> </span>
<a id="L73"></a><span class="visited"> </span>
<a id="L74"></a><span class="visited"> </span>
<a id="L75"></a><span > </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span class="visited"> </span>
<a id="L80"></a><span class="visited"> </span>
<a id="L81"></a><span class="visited"> </span>
<a id="L82"></a><span class="visited"> </span>
<a id="L83"></a><span > </span>
<a id="L84"></a><span class="visited"> </span>
<a id="L85"></a><span class="visited"> </span>
<a id="L86"></a><span class="visited"> </span>
<a id="L87"></a><span class="visited"> </span>
<a id="L88"></a><span > </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span class="visited"> </span>
<a id="L94"></a><span class="visited"> </span>
<a id="L95"></a><span class="visited"> </span>
<a id="L96"></a><span class="visited"> </span>
<a id="L97"></a><span class="visited"> </span>
<a id="L98"></a><span class="visited"> </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span class="visited"> </span>
<a id="L101"></a><span class="visited"> </span>
<a id="L102"></a><span > </span>
<a id="L103"></a><span class="visited"> </span>
<a id="L104"></a><span > </span>
<a id="L105"></a><span class="visited"> </span>
<a id="L106"></a><span class="visited"> </span>
<a id="L107"></a><span class="visited"> </span>
<a id="L108"></a><span class="visited"> </span>
<a id="L109"></a><span class="visited"> </span>
<a id="L110"></a><span > </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span > </span>
<a id="L113"></a><span > </span>
<a id="L114"></a><span class="visited"> </span>
<a id="L115"></a><span class="visited"> </span>
<a id="L116"></a><span > </span>
<a id="L117"></a><span class="visited"> </span>
<a id="L118"></a><span class="visited"> </span>
<a id="L119"></a><span class="visited"> </span>
<a id="L120"></a><span class="visited"> </span>
<a id="L121"></a><span class="visited"> </span>
<a id="L122"></a><span > </span>
<a id="L123"></a><span > </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span > </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span > </span>
<a id="L130"></a><span > </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span > </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span class="visited"> </span>
<a id="L136"></a><span class="visited"> </span>
<a id="L137"></a><span class="visited"> </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span class="visited"> </span>
<a id="L140"></a><span class="visited"> </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span class="visited"> </span>
<a id="L143"></a><span > </span>
<a id="L144"></a><span > </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span > </span>
<a id="L147"></a><span class="visited"> </span>
<a id="L148"></a><span > </span>
<a id="L149"></a><span > </span>
<a id="L150"></a><span class="visited"> </span>
<a id="L151"></a><span class="visited"> </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span > </span>
<a id="L154"></a><span class="visited"> </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span class="visited"> </span>
<a id="L157"></a><span class="some-visited"> </span>
<a id="L158"></a><span > </span>
<a id="L159"></a><span > </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span > </span>
<a id="L166"></a><span class="visited"> </span>
<a id="L167"></a><span class="visited"> </span>
<a id="L168"></a><span class="visited"> </span>
<a id="L169"></a><span > </span>
<a id="L170"></a><span class="visited"> </span>
<a id="L171"></a><span > </span>
<a id="L172"></a><span class="visited"> </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span > </span>
<a id="L175"></a><span class="visited"> </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span class="visited"> </span>
<a id="L178"></a><span class="visited"> </span>
<a id="L179"></a><span > </span>
<a id="L180"></a><span class="visited"> </span>
<a id="L181"></a><span class="visited"> </span>
<a id="L182"></a><span class="visited"> </span>
<a id="L183"></a><span class="visited"> </span>
<a id="L184"></a><span class="visited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span class="visited"> </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span class="visited"> </span>
<a id="L189"></a><span > </span>
<a id="L190"></a><span class="visited"> </span>
<a id="L191"></a><span class="visited"> </span>
<a id="L192"></a><span class="visited"> </span>
<a id="L193"></a><span > </span>
<a id="L194"></a><span class="visited"> </span>
<a id="L195"></a><span class="visited"> </span>
<a id="L196"></a><span class="visited"> </span>
<a id="L197"></a><span class="visited"> </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span class="visited"> </span>
<a id="L200"></a><span > </span>
<a id="L201"></a><span class="visited"> </span>
<a id="L202"></a><span > </span>
<a id="L203"></a><span class="visited"> </span>
<a id="L204"></a><span > </span>
<a id="L205"></a><span class="visited"> </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span > </span>
<a id="L209"></a><span > </span>
<a id="L210"></a><span > </span>
<a id="L211"></a><span > </span>
<a id="L212"></a><span > </span>
<a id="L213"></a><span class="unvisited"> </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span > </span>
<a id="L216"></a><span class="visited"> </span>
<a id="L217"></a><span > </span>
<a id="L218"></a><span > </span>
<a id="L219"></a><span > </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span > </span>
<a id="L222"></a><span > </span>
<a id="L223"></a><span > </span>
<a id="L224"></a><span > </span>
<a id="L225"></a><span class="visited"> </span>
<a id="L226"></a><span class="visited"> </span>
<a id="L227"></a><span class="visited"> </span>
<a id="L228"></a><span class="visited"> </span>
<a id="L229"></a><span > </span>
<a id="L230"></a><span > </span>
<a id="L231"></a><span class="visited"> </span>
<a id="L232"></a><span class="visited"> </span>
<a id="L233"></a><span > </span>
<a id="L234"></a><span class="visited"> </span>
<a id="L235"></a><span class="visited"> </span>
<a id="L236"></a><span > </span>
<a id="L237"></a><span > </span>
<a id="L238"></a><span > </span>
<a id="L239"></a><span class="visited"> </span>
<a id="L240"></a><span class="visited"> </span>
<a id="L241"></a><span class="visited"> </span>
<a id="L242"></a><span class="visited"> </span>
<a id="L243"></a><span class="visited"> </span>
<a id="L244"></a><span > </span>
<a id="L245"></a><span > </span>
<a id="L246"></a><span class="visited"> </span>
<a id="L247"></a><span class="visited"> </span>
<a id="L248"></a><span class="visited"> </span>
<a id="L249"></a><span class="visited"> </span>
<a id="L250"></a><span > </span>
<a id="L251"></a><span class="visited"> </span>
<a id="L252"></a><span class="visited"> </span>
<a id="L253"></a><span > </span>
<a id="L254"></a><span > </span>
<a id="L255"></a><span class="visited"> </span>
<a id="L256"></a><span class="visited"> </span>
<a id="L257"></a><span > </span>
<a id="L258"></a><span class="visited"> </span>
<a id="L259"></a><span > </span>
<a id="L260"></a><span class="visited"> </span>
<a id="L261"></a><span > </span>
<a id="L262"></a><span class="visited"> </span>
<a id="L263"></a><span class="visited"> </span>
<a id="L264"></a><span > </span>
<a id="L265"></a><span > </span>
<a id="L266"></a><span class="visited"> </span>
<a id="L267"></a><span class="visited"> </span>
<a id="L268"></a><span > </span>
<a id="L269"></a><span class="visited"> </span>
<a id="L270"></a><span class="visited"> </span>
<a id="L271"></a><span class="visited"> </span>
<a id="L272"></a><span class="visited"> </span>
<a id="L273"></a><span class="visited"> </span>
<a id="L274"></a><span > </span>
<a id="L275"></a><span > </span>
<a id="L276"></a><span > </span>
<a id="L277"></a><span > </span>
<a id="L278"></a><span > </span>
<a id="L279"></a><span class="visited"> </span>
<a id="L280"></a><span class="visited"> </span>
<a id="L281"></a><span > </span>
<a id="L282"></a><span > </span>
<a id="L283"></a><span > </span>
<a id="L284"></a><span > </span>
<a id="L285"></a><span class="visited"> </span>
<a id="L286"></a><span > </span>
<a id="L287"></a><span > </span>
<a id="L288"></a><span class="visited"> </span>
<a id="L289"></a><span class="visited"> </span>
<a id="L290"></a><span class="visited"> </span>
<a id="L291"></a><span > </span>
<a id="L292"></a><span > </span>
<a id="L293"></a><span class="visited"> </span>
<a id="L294"></a><span > </span>
<a id="L295"></a><span > </span>
<a id="L296"></a><span > </span>
<a id="L297"></a><span > </span>
<a id="L298"></a><span class="visited"> </span>
<a id="L299"></a><span class="visited"> </span>
<a id="L300"></a><span class="visited"> </span>
<a id="L301"></a><span class="visited"> </span>
<a id="L302"></a><span > </span>
<a id="L303"></a><span > </span>
<a id="L304"></a><span > </span>
<a id="L305"></a><span class="visited"> </span>
<a id="L306"></a><span class="visited"> </span>
<a id="L307"></a><span class="visited"> </span>
<a id="L308"></a><span > </span>
<a id="L309"></a><span class="visited"> </span>
<a id="L310"></a><span class="visited"> </span>
<a id="L311"></a><span > </span>
<a id="L312"></a><span class="visited"> </span>
<a id="L313"></a><span > </span>
<a id="L314"></a><span > </span>
<a id="L315"></a><span class="visited"> </span>
<a id="L316"></a><span class="visited"> </span>
<a id="L317"></a><span class="visited"> </span>
<a id="L318"></a><span class="visited"> </span>
<a id="L319"></a><span > </span>
<a id="L320"></a><span > </span>
<a id="L321"></a><span > </span>
<a id="L322"></a><span > </span>
<a id="L323"></a><span class="visited"> </span>
<a id="L324"></a><span class="visited"> </span>
<a id="L325"></a><span > </span>
<a id="L326"></a><span > </span>
<a id="L327"></a><span class="visited"> </span>
<a id="L328"></a><span > </span>
<a id="L329"></a><span > </span>
<a id="L330"></a><span > </span>
<a id="L331"></a><span > </span>
<a id="L332"></a><span class="visited"> </span>
<a id="L333"></a><span > </span>
<a id="L334"></a><span class="visited"> </span>
<a id="L335"></a><span class="visited"> </span>
<a id="L336"></a><span class="visited"> </span>
<a id="L337"></a><span > </span>
<a id="L338"></a><span class="visited"> </span>
<a id="L339"></a><span > </span>
<a id="L340"></a><span > </span>
<a id="L341"></a><span > </span>
<a id="L342"></a><span > </span>
<a id="L343"></a><span > </span>
<a id="L344"></a><span > </span>
<a id="L345"></a><span > </span>
<a id="L346"></a><span class="visited"> </span>
<a id="L347"></a><span class="visited"> </span>
<a id="L348"></a><span class="visited"> </span>
<a id="L349"></a><span class="visited"> </span>
<a id="L350"></a><span > </span>
<a id="L351"></a><span class="visited"> </span>
<a id="L352"></a><span > </span>
<a id="L353"></a><span class="visited"> </span>
<a id="L354"></a><span > </span>
<a id="L355"></a><span class="visited"> </span>
<a id="L356"></a><span class="visited"> </span>
<a id="L357"></a><span > </span>
<a id="L358"></a><span > </span>
<a id="L359"></a><span > </span>
<a id="L360"></a><span class="visited"> </span>
<a id="L361"></a><span class="visited"> </span>
<a id="L362"></a><span class="visited"> </span>
<a id="L363"></a><span class="visited"> </span>
<a id="L364"></a><span class="visited"> </span>
<a id="L365"></a><span > </span>
<a id="L366"></a><span class="visited"> </span>
<a id="L367"></a><span > </span>
<a id="L368"></a><span > </span>
<a id="L369"></a><span class="visited"> </span>
<a id="L370"></a><span > </span>
<a id="L371"></a><span class="visited"> </span>
<a id="L372"></a><span > </span>
<a id="L373"></a><span > </span>
<a id="L374"></a><span class="visited"> </span>
<a id="L375"></a><span class="visited"> </span>
<a id="L376"></a><span > </span>
<a id="L377"></a><span > </span>
<a id="L378"></a><span class="visited"> </span>
<a id="L379"></a><span class="visited"> </span>
<a id="L380"></a><span > </span>
<a id="L381"></a><span class="visited"> </span>
<a id="L382"></a><span class="visited"> </span>
<a id="L383"></a><span class="visited"> </span>
<a id="L384"></a><span class="visited"> </span>
<a id="L385"></a><span class="visited"> </span>
<a id="L386"></a><span > </span>
<a id="L387"></a><span class="visited"> </span>
<a id="L388"></a><span class="visited"> </span>
<a id="L389"></a><span class="visited"> </span>
<a id="L390"></a><span class="visited"> </span>
<a id="L391"></a><span > </span>
<a id="L392"></a><span class="visited"> </span>
<a id="L393"></a><span class="visited"> </span>
<a id="L394"></a><span class="visited"> </span>
<a id="L395"></a><span class="visited"> </span>
<a id="L396"></a><span > </span>
<a id="L397"></a><span class="visited"> </span>
<a id="L398"></a><span > </span>
<a id="L399"></a><span class="visited"> </span>
<a id="L400"></a><span > </span>
<a id="L401"></a><span > </span>
<a id="L402"></a><span > </span>
<a id="L403"></a><span class="visited"> </span>
<a id="L404"></a><span > </span>
<a id="L405"></a><span > </span>
<a id="L406"></a><span class="visited"> </span>
<a id="L407"></a><span class="visited"> </span>
<a id="L408"></a><span > </span>
<a id="L409"></a><span class="visited"> </span>
<a id="L410"></a><span class="visited"> </span>
<a id="L411"></a><span > </span>
<a id="L412"></a><span class="visited"> </span>
<a id="L413"></a><span class="visited"> </span>
<a id="L414"></a><span > </span>
<a id="L415"></a><span class="visited"> </span>
<a id="L416"></a><span class="visited"> </span>
<a id="L417"></a><span > </span>
<a id="L418"></a><span class="visited"> </span>
<a id="L419"></a><span class="visited"> </span>
<a id="L420"></a><span > </span>
<a id="L421"></a><span class="visited"> </span>
<a id="L422"></a><span > </span>
<a id="L423"></a><span class="visited"> </span>
<a id="L424"></a><span > </span>
<a id="L425"></a><span class="visited"> </span>
<a id="L426"></a><span > </span>
<a id="L427"></a><span > </span>
<a id="L428"></a><span class="visited"> </span>
<a id="L429"></a><span class="visited"> </span>
<a id="L430"></a><span class="visited"> </span>
<a id="L431"></a><span > </span>
<a id="L432"></a><span class="visited"> </span>
<a id="L433"></a><span class="visited"> </span>
<a id="L434"></a><span > </span>
<a id="L435"></a><span > </span>
<a id="L436"></a><span class="visited"> </span>
<a id="L437"></a><span > </span>
<a id="L438"></a><span > </span>
<a id="L439"></a><span > </span>
<a id="L440"></a><span class="visited"> </span>
<a id="L441"></a><span > </span>
<a id="L442"></a><span > </span>
<a id="L443"></a><span class="visited"> </span>
<a id="L444"></a><span > </span>
<a id="L445"></a><span > </span>
<a id="L446"></a><span class="visited"> </span>
<a id="L447"></a><span > </span>
<a id="L448"></a><span > </span>
<a id="L449"></a><span class="visited"> </span>
<a id="L450"></a><span > </span>
<a id="L451"></a><span > </span>
<a id="L452"></a><span > </span>
<a id="L453"></a><span class="visited"> </span>
<a id="L454"></a><span class="visited"> </span>
<a id="L455"></a><span > </span>
<a id="L456"></a><span class="visited"> </span>
<a id="L457"></a><span > </span>
<a id="L458"></a><span > </span>
<a id="L459"></a><span > </span>
<a id="L460"></a><span > </span>
<a id="L461"></a><span > </span>
<a id="L462"></a><span class="visited"> </span>
<a id="L463"></a><span class="visited"> </span>
<a id="L464"></a><span class="visited"> </span>
<a id="L465"></a><span class="visited"> </span>
<a id="L466"></a><span > </span>
<a id="L467"></a><span > </span>
<a id="L468"></a><span class="visited"> </span>
<a id="L469"></a><span class="visited"> </span>
<a id="L470"></a><span class="visited"> </span>
<a id="L471"></a><span class="visited"> </span>
<a id="L472"></a><span > </span>
<a id="L473"></a><span > </span>
<a id="L474"></a><span > </span>
<a id="L475"></a><span class="visited"> </span>
<a id="L476"></a><span class="visited"> </span>
<a id="L477"></a><span > </span>
<a id="L478"></a><span class="visited"> </span>
<a id="L479"></a><span class="visited"> </span>
<a id="L480"></a><span class="visited"> </span>
<a id="L481"></a><span class="visited"> </span>
<a id="L482"></a><span class="visited"> </span>
<a id="L483"></a><span > </span>
<a id="L484"></a><span class="visited"> </span>
<a id="L485"></a><span class="visited"> </span>
<a id="L486"></a><span > </span>
<a id="L487"></a><span > </span>
<a id="L488"></a><span > </span>
<a id="L489"></a><span > </span>
<a id="L490"></a><span > </span>
<a id="L491"></a><span > </span>
<a id="L492"></a><span class="visited"> </span>
<a id="L493"></a><span class="visited"> </span>
<a id="L494"></a><span class="visited"> </span>
<a id="L495"></a><span > </span>
<a id="L496"></a><span > </span>
<a id="L497"></a><span class="visited"> </span>
<a id="L498"></a><span > </span>
<a id="L499"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
<a href="#L224">224</a>
<a href="#L225">225</a>
<a href="#L226">226</a>
<a href="#L227">227</a>
<a href="#L228">228</a>
<a href="#L229">229</a>
<a href="#L230">230</a>
<a href="#L231">231</a>
<a href="#L232">232</a>
<a href="#L233">233</a>
<a href="#L234">234</a>
<a href="#L235">235</a>
<a href="#L236">236</a>
<a href="#L237">237</a>
<a href="#L238">238</a>
<a href="#L239">239</a>
<a href="#L240">240</a>
<a href="#L241">241</a>
<a href="#L242">242</a>
<a href="#L243">243</a>
<a href="#L244">244</a>
<a href="#L245">245</a>
<a href="#L246">246</a>
<a href="#L247">247</a>
<a href="#L248">248</a>
<a href="#L249">249</a>
<a href="#L250">250</a>
<a href="#L251">251</a>
<a href="#L252">252</a>
<a href="#L253">253</a>
<a href="#L254">254</a>
<a href="#L255">255</a>
<a href="#L256">256</a>
<a href="#L257">257</a>
<a href="#L258">258</a>
<a href="#L259">259</a>
<a href="#L260">260</a>
<a href="#L261">261</a>
<a href="#L262">262</a>
<a href="#L263">263</a>
<a href="#L264">264</a>
<a href="#L265">265</a>
<a href="#L266">266</a>
<a href="#L267">267</a>
<a href="#L268">268</a>
<a href="#L269">269</a>
<a href="#L270">270</a>
<a href="#L271">271</a>
<a href="#L272">272</a>
<a href="#L273">273</a>
<a href="#L274">274</a>
<a href="#L275">275</a>
<a href="#L276">276</a>
<a href="#L277">277</a>
<a href="#L278">278</a>
<a href="#L279">279</a>
<a href="#L280">280</a>
<a href="#L281">281</a>
<a href="#L282">282</a>
<a href="#L283">283</a>
<a href="#L284">284</a>
<a href="#L285">285</a>
<a href="#L286">286</a>
<a href="#L287">287</a>
<a href="#L288">288</a>
<a href="#L289">289</a>
<a href="#L290">290</a>
<a href="#L291">291</a>
<a href="#L292">292</a>
<a href="#L293">293</a>
<a href="#L294">294</a>
<a href="#L295">295</a>
<a href="#L296">296</a>
<a href="#L297">297</a>
<a href="#L298">298</a>
<a href="#L299">299</a>
<a href="#L300">300</a>
<a href="#L301">301</a>
<a href="#L302">302</a>
<a href="#L303">303</a>
<a href="#L304">304</a>
<a href="#L305">305</a>
<a href="#L306">306</a>
<a href="#L307">307</a>
<a href="#L308">308</a>
<a href="#L309">309</a>
<a href="#L310">310</a>
<a href="#L311">311</a>
<a href="#L312">312</a>
<a href="#L313">313</a>
<a href="#L314">314</a>
<a href="#L315">315</a>
<a href="#L316">316</a>
<a href="#L317">317</a>
<a href="#L318">318</a>
<a href="#L319">319</a>
<a href="#L320">320</a>
<a href="#L321">321</a>
<a href="#L322">322</a>
<a href="#L323">323</a>
<a href="#L324">324</a>
<a href="#L325">325</a>
<a href="#L326">326</a>
<a href="#L327">327</a>
<a href="#L328">328</a>
<a href="#L329">329</a>
<a href="#L330">330</a>
<a href="#L331">331</a>
<a href="#L332">332</a>
<a href="#L333">333</a>
<a href="#L334">334</a>
<a href="#L335">335</a>
<a href="#L336">336</a>
<a href="#L337">337</a>
<a href="#L338">338</a>
<a href="#L339">339</a>
<a href="#L340">340</a>
<a href="#L341">341</a>
<a href="#L342">342</a>
<a href="#L343">343</a>
<a href="#L344">344</a>
<a href="#L345">345</a>
<a href="#L346">346</a>
<a href="#L347">347</a>
<a href="#L348">348</a>
<a href="#L349">349</a>
<a href="#L350">350</a>
<a href="#L351">351</a>
<a href="#L352">352</a>
<a href="#L353">353</a>
<a href="#L354">354</a>
<a href="#L355">355</a>
<a href="#L356">356</a>
<a href="#L357">357</a>
<a href="#L358">358</a>
<a href="#L359">359</a>
<a href="#L360">360</a>
<a href="#L361">361</a>
<a href="#L362">362</a>
<a href="#L363">363</a>
<a href="#L364">364</a>
<a href="#L365">365</a>
<a href="#L366">366</a>
<a href="#L367">367</a>
<a href="#L368">368</a>
<a href="#L369">369</a>
<a href="#L370">370</a>
<a href="#L371">371</a>
<a href="#L372">372</a>
<a href="#L373">373</a>
<a href="#L374">374</a>
<a href="#L375">375</a>
<a href="#L376">376</a>
<a href="#L377">377</a>
<a href="#L378">378</a>
<a href="#L379">379</a>
<a href="#L380">380</a>
<a href="#L381">381</a>
<a href="#L382">382</a>
<a href="#L383">383</a>
<a href="#L384">384</a>
<a href="#L385">385</a>
<a href="#L386">386</a>
<a href="#L387">387</a>
<a href="#L388">388</a>
<a href="#L389">389</a>
<a href="#L390">390</a>
<a href="#L391">391</a>
<a href="#L392">392</a>
<a href="#L393">393</a>
<a href="#L394">394</a>
<a href="#L395">395</a>
<a href="#L396">396</a>
<a href="#L397">397</a>
<a href="#L398">398</a>
<a href="#L399">399</a>
<a href="#L400">400</a>
<a href="#L401">401</a>
<a href="#L402">402</a>
<a href="#L403">403</a>
<a href="#L404">404</a>
<a href="#L405">405</a>
<a href="#L406">406</a>
<a href="#L407">407</a>
<a href="#L408">408</a>
<a href="#L409">409</a>
<a href="#L410">410</a>
<a href="#L411">411</a>
<a href="#L412">412</a>
<a href="#L413">413</a>
<a href="#L414">414</a>
<a href="#L415">415</a>
<a href="#L416">416</a>
<a href="#L417">417</a>
<a href="#L418">418</a>
<a href="#L419">419</a>
<a href="#L420">420</a>
<a href="#L421">421</a>
<a href="#L422">422</a>
<a href="#L423">423</a>
<a href="#L424">424</a>
<a href="#L425">425</a>
<a href="#L426">426</a>
<a href="#L427">427</a>
<a href="#L428">428</a>
<a href="#L429">429</a>
<a href="#L430">430</a>
<a href="#L431">431</a>
<a href="#L432">432</a>
<a href="#L433">433</a>
<a href="#L434">434</a>
<a href="#L435">435</a>
<a href="#L436">436</a>
<a href="#L437">437</a>
<a href="#L438">438</a>
<a href="#L439">439</a>
<a href="#L440">440</a>
<a href="#L441">441</a>
<a href="#L442">442</a>
<a href="#L443">443</a>
<a href="#L444">444</a>
<a href="#L445">445</a>
<a href="#L446">446</a>
<a href="#L447">447</a>
<a href="#L448">448</a>
<a href="#L449">449</a>
<a href="#L450">450</a>
<a href="#L451">451</a>
<a href="#L452">452</a>
<a href="#L453">453</a>
<a href="#L454">454</a>
<a href="#L455">455</a>
<a href="#L456">456</a>
<a href="#L457">457</a>
<a href="#L458">458</a>
<a href="#L459">459</a>
<a href="#L460">460</a>
<a href="#L461">461</a>
<a href="#L462">462</a>
<a href="#L463">463</a>
<a href="#L464">464</a>
<a href="#L465">465</a>
<a href="#L466">466</a>
<a href="#L467">467</a>
<a href="#L468">468</a>
<a href="#L469">469</a>
<a href="#L470">470</a>
<a href="#L471">471</a>
<a href="#L472">472</a>
<a href="#L473">473</a>
<a href="#L474">474</a>
<a href="#L475">475</a>
<a href="#L476">476</a>
<a href="#L477">477</a>
<a href="#L478">478</a>
<a href="#L479">479</a>
<a href="#L480">480</a>
<a href="#L481">481</a>
<a href="#L482">482</a>
<a href="#L483">483</a>
<a href="#L484">484</a>
<a href="#L485">485</a>
<a href="#L486">486</a>
<a href="#L487">487</a>
<a href="#L488">488</a>
<a href="#L489">489</a>
<a href="#L490">490</a>
<a href="#L491">491</a>
<a href="#L492">492</a>
<a href="#L493">493</a>
<a href="#L494">494</a>
<a href="#L495">495</a>
<a href="#L496">496</a>
<a href="#L497">497</a>
<a href="#L498">498</a>
<a href="#L499">499</a>
</pre>
        <pre id="code">
(*
 * This file is part of Bisect.
 * Copyright (C) 2008-2012 Xavier Clerc.
 *
 * Bisect is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * Bisect is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *)

open Parsetree
open Asttypes
open Ast_mapper
open Ast_helper

let intconst x =
  <span data-count="1450">E</span>xp.constant (Const_int x)

let lid ?(loc = <span data-count="2516">L</span>ocation.none) s =
  <span data-count="2558">L</span>ocation.mkloc (Longident.parse s) loc

let constr id =
  <span data-count="174">l</span>et t = <span data-count="174">L</span>ocation.mkloc (Longident.parse id) Location.none in
  <span data-count="174">E</span>xp.construct t None

let unitconst () = <span data-count="174">c</span>onstr "()"

let strconst s =
  <span data-count="124">E</span>xp.constant (Const_string (s, None))

let string_of_ident ident =
  <span data-count="458">S</span>tring.concat "." (Longident.flatten ident.txt)

let apply_nolabs ?loc lid el =
  <span data-count="1776">E</span>xp.apply ?loc
    (Exp.ident ?loc lid)
    (List.map (fun e -&gt; <span data-count="2272">(</span>"",e)) el)

let custom_mark_function file =
  <span data-count="1364">P</span>rintf.sprintf "___bisect_mark___%s"
    (* Turn's out that the variable name syntax isn't checked again,
       so directory separtors '\' seem to be fine,
       and this extension chop might not be necessary. *)
    (Filename.chop_extension file)

let case_variable = <span data-count="86">"</span>___bisect_matched_value___"

(* Evaluates to a point at the given location. If the point does not yet exist,
   creates it with the given kind. The point is paired with a flag indicating
   whether it exited before this function was called. *)
let get_point file ofs kind marked =
  <span data-count="1320">l</span>et lst = <span data-count="1320">I</span>nstrumentState.get_points_for_file file in

  <span data-count="1320">l</span>et maybe_existing =
    <span data-count="1320">t</span>ry Some (List.find (fun p -&gt; <span data-count="23054">p</span>.Common.offset = ofs) lst)
    with <span data-count="1250">N</span>ot_found -&gt; None
  in

  <span data-count="1320">m</span>atch maybe_existing with
  | <span data-count="70">S</span>ome pt -&gt; pt, true
  | <span data-count="1250">N</span>one -&gt;
    let idx = <span data-count="1250">L</span>ist.length lst in
    <span data-count="1250">i</span>f marked then <span data-count="2">I</span>nstrumentState.add_marked_point idx;
    <span data-count="1250">l</span>et pt = <span data-count="1250">{</span> Common.offset = ofs; identifier = idx; kind = kind } in
    <span data-count="1250">I</span>nstrumentState.set_points_for_file file (pt :: lst);
    <span data-count="1250">p</span>t, false

(* Creates the marking expression for given file, offset, and kind.
   Populates the 'points' global variable. *)
let marker must_be_unique file ofs kind marked =
  <span data-count="1320">l</span>et { Common.identifier = idx; _ }, existing =
    <span data-count="1320">g</span>et_point file ofs kind marked in
  <span data-count="1320">i</span>f <span data-count="1320">m</span>ust_be_unique &amp;&amp; <span data-count="930">e</span>xisting then
    <span data-count="38">N</span>one
  else
    <span data-count="1282">l</span>et loc = <span data-count="1282">L</span>ocation.none in
    <span data-count="1282">l</span>et wrapped =
      <span data-count="1282">a</span>pply_nolabs ~loc (lid (custom_mark_function file)) [intconst idx] in
    <span data-count="1282">S</span>ome wrapped

(* Wraps an expression with a marker, returning the passed expression
   unmodified if the expression is already marked, has a ghost location,
   construct instrumentation is disabled, or a special comments indicates to
   ignore line. *)
let wrap_expr ?(must_be_unique = <span data-count="1190">t</span>rue) ?loc k e =
  <span data-count="1580">l</span>et enabled = <span data-count="1580">L</span>ist.assoc k InstrumentArgs.kinds in
  <span data-count="1580">l</span>et loc =
    <span data-count="1580">m</span>atch loc with
    | <span data-count="1184">N</span>one -&gt; e.pexp_loc
    | <span data-count="396">S</span>ome loc -&gt; loc
  in
  <span data-count="1580">i</span>f <span data-count="1580">l</span>oc.Location.loc_ghost || <span data-count="1346">n</span>ot !enabled then
    <span data-count="234">e</span>
  else
    <span data-count="1346">l</span>et ofs = <span data-count="1346">l</span>oc.Location.loc_start.Lexing.pos_cnum in
    (* Different files because of the line directive *)
    <span data-count="1346">l</span>et file = <span data-count="1346">l</span>oc.Location.loc_start.Lexing.pos_fname in
    <span data-count="1346">l</span>et line = <span data-count="1346">l</span>oc.Location.loc_start.Lexing.pos_lnum in
    <span data-count="1346">l</span>et c = <span data-count="1346">C</span>ommentsPpx.get file in
    <span data-count="1346">l</span>et ignored =
      <span data-count="1346">L</span>ist.exists
        (fun (lo, hi) -&gt;
          <span data-count="162">l</span>ine &gt;= lo &amp;&amp; <span data-count="82">l</span>ine &lt;= hi)
        c.CommentsPpx.ignored_intervals
    in
    <span data-count="1346">i</span>f ignored then
      <span data-count="26">e</span>
    else
      <span data-count="1320">l</span>et marked = <span data-count="1320">L</span>ist.mem line c.CommentsPpx.marked_lines in
      <span data-count="1320">l</span>et marker_file = <span data-count="1320">!</span>Location.input_name in
      <span data-count="1320">m</span>atch marker must_be_unique marker_file ofs k marked with
      | <span data-count="1282">S</span>ome w -&gt; Exp.sequence ~loc w e
      | <span data-count="38">N</span>one   -&gt; e

(* Given a pattern and a location, transforms the pattern into pattern list by
   eliminating all or-patterns and promoting them into separate cases. Each
   resulting case is paired with a list of locations to mark if that case is
   reached.

   The location argument to this function is used for assembling these location
   lists. It is set to the location of the nearest enclosing or-pattern clause.
   When there is no such clause, it is set to the location of the entire
   enclosing pattern. *)
let translate_pattern =
  (* n-ary Cartesion product of case patterns. Used for assembling case lists
     for "and-patterns" such as tuples and arrays. *)
  <span data-count="86">l</span>et product = <span data-count="86">f</span>unction
    | <span data-count="2">[</span>] -&gt; []
    | <span data-count="30">c</span>ases::more -&gt;
      let multiply product cases =
        <span data-count="32">p</span>roduct |&gt; <span data-count="32">L</span>ist.map (fun (marks_1, ps) -&gt;
          <span data-count="46">c</span>ases |&gt; <span data-count="46">L</span>ist.map (fun (marks_2, p) -&gt;
            <span data-count="58">m</span>arks_1 @ marks_2, ps @ [p]))
        |&gt; <span data-count="32">L</span>ist.flatten
      in

      <span data-count="30">l</span>et initial = <span data-count="30">c</span>ases |&gt; <span data-count="30">L</span>ist.map (fun (marks, p) -&gt; <span data-count="38">m</span>arks, [p]) in

      <span data-count="30">L</span>ist.fold_left multiply initial more
  in

  <span data-count="86">l</span>et rec translate mark p =
    <span data-count="536">l</span>et loc = <span data-count="536">p</span>.ppat_loc in
    <span data-count="536">l</span>et attrs = <span data-count="536">p</span>.ppat_attributes in

    <span data-count="536">m</span>atch p.ppat_desc with
    | <span data-count="72">P</span>pat_any | <span data-count="42">P</span>pat_var _ | <span data-count="152">P</span>pat_constant _ | <span data-count="2">P</span>pat_interval _
    | <span data-count="104">P</span>pat_construct (_, None) | <span data-count="4">P</span>pat_variant (_, None) | <span data-count="2">P</span>pat_type _
    | <span data-count="2">P</span>pat_unpack _ | <span data-count="0">P</span>pat_extension _ -&gt;
      [[mark], p]

    | <span data-count="6">P</span>pat_alias (p', x) -&gt;
      translate mark p'
      |&gt; <span data-count="6">L</span>ist.map (fun (marks, p'') -&gt; <span data-count="8">m</span>arks, Pat.alias ~loc ~attrs p'' x)

    | <span data-count="26">P</span>pat_tuple ps -&gt;
      ps
      |&gt; <span data-count="26">L</span>ist.map (translate mark)
      |&gt; <span data-count="26">p</span>roduct
      |&gt; <span data-count="26">L</span>ist.map (fun (marks, ps') -&gt; <span data-count="34">m</span>arks, Pat.tuple ~loc ~attrs ps')

    | <span data-count="4">P</span>pat_construct (c, Some p') -&gt;
      translate mark p'
      |&gt; <span data-count="4">L</span>ist.map (fun (marks, p'') -&gt;
        <span data-count="8">m</span>arks, Pat.construct ~loc ~attrs c (Some p''))

    | <span data-count="8">P</span>pat_variant (c, Some p') -&gt;
      translate mark p'
      |&gt; <span data-count="8">L</span>ist.map (fun (marks, p'') -&gt;
        <span data-count="10">m</span>arks, Pat.variant ~loc ~attrs c (Some p''))

    | <span data-count="2">P</span>pat_record (entries, closed) -&gt;
      let labels, ps = <span data-count="2">L</span>ist.split entries in
      <span data-count="2">p</span>s
      |&gt; <span data-count="2">L</span>ist.map (translate mark)
      |&gt; <span data-count="2">p</span>roduct
      |&gt; <span data-count="2">L</span>ist.map (fun (marks, ps') -&gt;
        <span data-count="8">m</span>arks, Pat.record ~loc ~attrs (List.combine labels ps') closed)

    | <span data-count="4">P</span>pat_array ps -&gt;
      ps
      |&gt; <span data-count="4">L</span>ist.map (translate mark)
      |&gt; <span data-count="4">p</span>roduct
      |&gt; <span data-count="4">L</span>ist.map (fun (marks, ps') -&gt; <span data-count="8">m</span>arks, Pat.array ~loc ~attrs ps')

    | <span data-count="102">P</span>pat_or (p_1, p_2) -&gt;
      let ps_1 = <span data-count="102">t</span>ranslate p_1.ppat_loc p_1 in
      <span data-count="102">l</span>et ps_2 = <span data-count="102">t</span>ranslate p_2.ppat_loc p_2 in
      <span data-count="102">p</span>s_1 @ ps_2

    | <span data-count="2">P</span>pat_constraint (p', t) -&gt;
      translate mark p'
      |&gt; <span data-count="2">L</span>ist.map (fun (marks, p'') -&gt; <span data-count="2">m</span>arks, Pat.constraint_ ~loc ~attrs p'' t)

    | <span data-count="2">P</span>pat_lazy p' -&gt;
      translate mark p'
      |&gt; <span data-count="2">L</span>ist.map (fun (marks, p'') -&gt; <span data-count="4">m</span>arks, Pat.lazy_ ~loc ~attrs p'')

    (* This should be unreachable in well-formed code, but, if it is reached,
       do not generate any cases. The cases would be used in a secondary match
       expression that works on the same value as the match expression (or
       function expression) that is being instrumented. Inside that expression,
       it makes no sense to match a second time for effects such as
       exceptions. *)
    | <span data-count="0">P</span>pat_exception _ -&gt; []
  in

  <span data-count="86">t</span>ranslate

(* Wraps a match or function case. A transformed pattern list is first created,
   where all or-patterns are promoted to top-level patterns. If there is only
   one resulting top-level pattern, wrap_case inserts a single point and marking
   expression. If there are multiple top-level patterns, wrap_case inserts a
   match expression that determines, at runtime, which one is matched, and
   increments the appropriate point counts. *)
let wrap_case k case =
  <span data-count="252">l</span>et maybe_guard =
    <span data-count="252">m</span>atch case.pc_guard with
    | <span data-count="234">N</span>one -&gt; None
    | <span data-count="18">S</span>ome guard -&gt; Some (wrap_expr k guard)
  in

  <span data-count="252">l</span>et pattern = <span data-count="252">c</span>ase.pc_lhs in
  <span data-count="252">l</span>et loc = <span data-count="252">p</span>attern.ppat_loc in

  <span data-count="252">i</span>f !InstrumentArgs.simple_cases then
    <span data-count="4">E</span>xp.case pattern ?guard:maybe_guard (wrap_expr ~loc k case.pc_rhs)
  else
    (* If this is an exception case, work with the pattern inside the exception
       instead. *)
    <span data-count="248">l</span>et pure_pattern, reassemble =
      <span data-count="248">m</span>atch pattern.ppat_desc with
      | <span data-count="2">P</span>pat_exception p -&gt;
        p, (fun p' -&gt; <span data-count="2">{</span>pattern with ppat_desc = Ppat_exception p'})
      | <span data-count="246">_</span> -&gt; pattern, (fun p -&gt; <span data-count="40">p</span>)
    in

    <span data-count="248">l</span>et increments e marks =
      <span data-count="378">m</span>arks
      |&gt; <span data-count="378">L</span>ist.sort_uniq (fun l l' -&gt;
        <span data-count="66">l</span>.Location.loc_start.Lexing.pos_cnum -
        l'.Location.loc_start.Lexing.pos_cnum)
      |&gt; <span data-count="378">L</span>ist.fold_left (fun e l -&gt;
        <span data-count="390">w</span>rap_expr ~must_be_unique:false ~loc:l k e) e
    in

    <span data-count="248">m</span>atch translate_pattern loc pure_pattern with
    | <span data-count="2">[</span>] -&gt;
      Exp.case pattern ?guard:maybe_guard (wrap_expr ~loc k case.pc_rhs)
    | <span data-count="204">[</span>marks, _] -&gt;
      Exp.case pattern ?guard:maybe_guard (increments case.pc_rhs marks)
    | <span data-count="42">c</span>ases -&gt;
      let cases =
        <span data-count="42">i</span>f !InstrumentArgs.inexhaustive_matching then <span data-count="18">c</span>ases
        else <span data-count="24">c</span>ases @ [[], Pat.any ~loc ()]
      in

      <span data-count="42">l</span>et wrapped_pattern =
        <span data-count="42">P</span>at.alias ~loc pure_pattern (Location.mkloc case_variable loc) in

      <span data-count="42">l</span>et marks_expr =
        <span data-count="42">c</span>ases
        |&gt; <span data-count="42">L</span>ist.map (fun (marks, pattern) -&gt;
          <span data-count="174">E</span>xp.case pattern (increments (unitconst ()) marks))
        |&gt; <span data-count="42">E</span>xp.match_ ~loc (Exp.ident (lid ~loc case_variable))
      in

      (* Suppress warnings because the generated match expression will almost
         never be exhaustive. It may also have redundant cases or unused
         variables. *)
      <span data-count="42">l</span>et marks_expr =
        <span data-count="42">E</span>xp.attr marks_expr
          (Location.mkloc "ocaml.warning" loc,
            PStr [Str.eval (strconst "-4-8-9-11-26-27-28")])
      in

      <span data-count="42">E</span>xp.case (reassemble wrapped_pattern) ?guard:maybe_guard
        (Exp.sequence ~loc marks_expr case.pc_rhs)

let wrap_class_field_kind k = <span data-count="22">f</span>unction
  | <span data-count="2">C</span>fk_virtual _ as cf -&gt; cf
  | <span data-count="20">C</span>fk_concrete (o,e)  -&gt; Cf.concrete o (wrap_expr k e)

let pattern_var id =
  <span data-count="328">P</span>at.var (Location.mkloc id Location.none)

(* This method is stateful and depends on `InstrumentState.set_points_for_file`
   having been run on all the points in the rest of the AST. *)
let faster file =
  <span data-count="82">l</span>et nb = <span data-count="82">L</span>ist.length (InstrumentState.get_points_for_file file) in
  <span data-count="82">l</span>et ilid s = <span data-count="740">E</span>xp.ident (lid s) in
  <span data-count="82">l</span>et init =
    <span data-count="82">a</span>pply_nolabs
      (lid ((!InstrumentArgs.runtime_name) ^ ".Runtime.init_with_array"))
      [strconst file; ilid "marks"]
  in
  <span data-count="82">l</span>et make = <span data-count="82">a</span>pply_nolabs (lid "Array.make") [intconst nb; intconst 0] in
  <span data-count="82">l</span>et marks =
    <span data-count="82">L</span>ist.fold_left
      (fun acc (idx, nb) -&gt;
        <span data-count="2">l</span>et mark =
          <span data-count="2">a</span>pply_nolabs (lid "Array.set") [ ilid "marks"; intconst idx; intconst nb]
        in
        <span data-count="2">E</span>xp.sequence acc mark)
      init
      (InstrumentState.get_marked_points_assoc ()) in
  <span data-count="82">l</span>et func =
    <span data-count="82">l</span>et body =
      <span data-count="82">l</span>et if_then_else =
        <span data-count="82">E</span>xp.ifthenelse
            (apply_nolabs (lid "&lt;") [ilid "curr"; ilid "Pervasives.max_int"])
            (apply_nolabs (lid "Pervasives.succ") [ilid "curr"])
            (Some (ilid "curr"))
      in
      <span data-count="82">l</span>et vb =
        <span data-count="82">V</span>b.mk (pattern_var "curr")
              (apply_nolabs (lid "Array.get") [ilid "marks"; ilid "idx"])
      in
      <span data-count="82">E</span>xp.let_ Nonrecursive [vb]
          (apply_nolabs
              (lid "Array.set")
              [ilid "marks"; ilid "idx"; if_then_else])
    in
    <span data-count="82">E</span>xp.(function_ [ case (pattern_var "idx") body ])
  in
  <span data-count="82">l</span>et vb = <span data-count="82">[</span>(Vb.mk (pattern_var "marks") make)] in
  <span data-count="82">l</span>et e =
    <span data-count="82">E</span>xp.(let_ Nonrecursive vb (sequence marks func))
  in
  <span data-count="82">S</span>tr.value Nonrecursive [ Vb.mk (pattern_var (custom_mark_function file)) e]

(* The actual "instrumenter" object, marking expressions. *)
class instrumenter = object (self)

  inherit Ast_mapper_class.mapper as super

  method! class_expr ce =
    <span data-count="16">l</span>et loc = <span data-count="16">c</span>e.pcl_loc in
    <span data-count="16">l</span>et ce = <span data-count="16">s</span>uper#class_expr ce in
    <span data-count="16">m</span>atch ce.pcl_desc with
    | <span data-count="2">P</span>cl_apply (ce, l) -&gt;
        let l =
          <span data-count="2">L</span>ist.map
            (fun (l, e) -&gt;
              <span data-count="2">(</span>l, (wrap_expr Common.Class_expr e)))
            l in
        <span data-count="2">C</span>l.apply ~loc ~attrs:ce.pcl_attributes ce l
    | <span data-count="14">_</span> -&gt;
        ce

  method! class_field cf =
    <span data-count="28">l</span>et loc = <span data-count="28">c</span>f.pcf_loc in
    <span data-count="28">l</span>et attrs = <span data-count="28">c</span>f.pcf_attributes in
    <span data-count="28">l</span>et cf = <span data-count="28">s</span>uper#class_field cf in
    <span data-count="28">m</span>atch cf.pcf_desc with
    | <span data-count="4">P</span>cf_val (id, mut, cf) -&gt;
        Cf.val_ ~loc ~attrs id mut (wrap_class_field_kind Common.Class_val cf)
    | <span data-count="18">P</span>cf_method (id, mut, cf) -&gt;
        Cf.method_ ~loc ~attrs id mut
          (wrap_class_field_kind Common.Class_meth cf)
    | <span data-count="4">P</span>cf_initializer e -&gt;
        Cf.initializer_ ~loc ~attrs (wrap_expr Common.Class_init e)
    | <span data-count="2">_</span> -&gt;
        cf

  val mutable extension_guard = <span data-count="86">f</span>alse
  val mutable attribute_guard = <span data-count="86">f</span>alse

  method! expr e =
    <span data-count="4018">i</span>f <span data-count="4018">a</span>ttribute_guard || <span data-count="4008">e</span>xtension_guard then
      <span data-count="14">s</span>uper#expr e
    else
      <span data-count="4004">l</span>et loc = <span data-count="4004">e</span>.pexp_loc in
      <span data-count="4004">l</span>et attrs = <span data-count="4004">e</span>.pexp_attributes in
      <span data-count="4004">l</span>et e' = <span data-count="4004">s</span>uper#expr e in
      <span data-count="4004">m</span>atch e'.pexp_desc with
      | <span data-count="42">P</span>exp_let (rec_flag, l, e) -&gt;
          let l =
            <span data-count="42">L</span>ist.map (fun vb -&gt;
            <span data-count="42">{</span>vb with pvb_expr = wrap_expr Common.Sequence vb.pvb_expr}) l in
          <span data-count="42">E</span>xp.let_ ~loc ~attrs rec_flag l (wrap_expr Common.Sequence e)
      | <span data-count="16">P</span>exp_poly (e, ct) -&gt;
          Exp.poly ~loc ~attrs (wrap_expr Common.Sequence e) ct
      | <span data-count="250">P</span>exp_fun (al, eo, p, e) -&gt;
          let eo = <span data-count="250">m</span>ap_opt (wrap_expr Common.Match) eo in
          <span data-count="250">E</span>xp.fun_ ~loc ~attrs al eo p (wrap_expr Common.Match e)
      | <span data-count="240">P</span>exp_apply (e1, [l2, e2; l3, e3]) -&gt;
          (match e1.pexp_desc with
          | <span data-count="22">P</span>exp_ident ident
            when
              <span data-count="240">L</span>ist.mem (string_of_ident ident) [ "&amp;&amp;"; "&amp;"; "||"; "or" ] -&gt;
                Exp.apply ~loc ~attrs e1
                  [l2, (wrap_expr Common.Lazy_operator e2);
                  l3, (wrap_expr Common.Lazy_operator e3)]
          | <span data-count="42">P</span>exp_ident ident when <span data-count="218">s</span>tring_of_ident ident = "|&gt;" -&gt;
            Exp.apply ~loc ~attrs e1
              [l2, e2; l3, (wrap_expr Common.Sequence e3)]
          | <span data-count="176">_</span> -&gt; e')
      | <span data-count="84">P</span>exp_match (e, l) -&gt;
          List.map (wrap_case Common.Match) l
          |&gt; <span data-count="84">E</span>xp.match_ ~loc ~attrs e
      | <span data-count="36">P</span>exp_function l -&gt;
          List.map (wrap_case Common.Match) l
          |&gt; <span data-count="36">E</span>xp.function_ ~loc ~attrs
      | <span data-count="24">P</span>exp_try (e, l) -&gt;
          List.map (wrap_case Common.Try) l
          |&gt; <span data-count="24">E</span>xp.try_ ~loc ~attrs e
      | <span data-count="50">P</span>exp_ifthenelse (e1, e2, e3) -&gt;
          Exp.ifthenelse ~loc ~attrs e1 (wrap_expr Common.If_then e2)
            (match e3 with <span data-count="48">S</span>ome x -&gt; Some (wrap_expr Common.If_then x) | <span data-count="2">N</span>one -&gt; None)
      | <span data-count="164">P</span>exp_sequence (e1, e2) -&gt;
          Exp.sequence ~loc ~attrs e1 (wrap_expr Common.Sequence e2)
      | <span data-count="4">P</span>exp_while (e1, e2) -&gt;
          Exp.while_ ~loc ~attrs e1 (wrap_expr Common.While e2)
      | <span data-count="34">P</span>exp_for (id, e1, e2, dir, e3) -&gt;
          Exp.for_ ~loc ~attrs id e1 e2 dir (wrap_expr Common.For e3)
      | <span data-count="3060">_</span> -&gt; e'

  method! structure_item si =
    <span data-count="456">l</span>et loc = <span data-count="456">s</span>i.pstr_loc in
    <span data-count="456">m</span>atch si.pstr_desc with
    | <span data-count="408">P</span>str_value (rec_flag, l) -&gt;
        let l =
          <span data-count="408">L</span>ist.map (fun vb -&gt;     (* Only instrument things not excluded. *)
            <span data-count="412">{</span> vb with pvb_expr =
                match vb.pvb_pat.ppat_desc with
                  (* Match the 'f' in 'let f x = ... ' *)
                | <span data-count="8">P</span>pat_var ident when <span data-count="304">E</span>xclusions.contains
                      (ident.loc.Location.loc_start.Lexing.pos_fname)
                    ident.txt -&gt; vb.pvb_expr
                  (* Match the 'f' in 'let f : type a. a -&gt; string = ...' *)
                | <span data-count="12">P</span>pat_constraint (p,_) -&gt;
                    begin
                      match p.ppat_desc with
                      | <span data-count="2">P</span>pat_var ident when <span data-count="12">E</span>xclusions.contains
                          (ident.loc.Location.loc_start.Lexing.pos_fname)
                            ident.txt -&gt; vb.pvb_expr
                      | <span data-count="10">_</span> -&gt;
                        wrap_expr Common.Binding (self#expr vb.pvb_expr)
                    end
                | <span data-count="392">_</span> -&gt;
                    wrap_expr Common.Binding (self#expr vb.pvb_expr)})
          l
        in
          <span data-count="408">S</span>tr.value ~loc rec_flag l
    | <span data-count="2">P</span>str_eval (e, a) when <span data-count="16">n</span>ot (<span data-count="16">a</span>ttribute_guard || <span data-count="6">e</span>xtension_guard) -&gt;
        Str.eval ~loc ~attrs:a (wrap_expr Common.Toplevel_expr (self#expr e))
    | <span data-count="46">_</span> -&gt;
        super#structure_item si

  (* Guard these because they can carry payloads that we
     do not want to instrument. *)
  method! extension e =
    <span data-count="4">e</span>xtension_guard &lt;- true;
    <span data-count="4">l</span>et r = <span data-count="4">s</span>uper#extension e in
    <span data-count="4">e</span>xtension_guard &lt;- false;
    <span data-count="4">r</span>

  method! attribute a =
    <span data-count="24">a</span>ttribute_guard &lt;- true;
    <span data-count="24">l</span>et r = <span data-count="24">s</span>uper#attribute a in
    <span data-count="24">a</span>ttribute_guard &lt;- false;
    <span data-count="24">r</span>

  (* Initializes storage and applies requested marks. *)
  method! structure ast =
    <span data-count="116">i</span>f <span data-count="116">e</span>xtension_guard || <span data-count="112">a</span>ttribute_guard then
      <span data-count="28">s</span>uper#structure ast
    else
      <span data-count="88">l</span>et file = <span data-count="88">!</span>Location.input_name in
      <span data-count="88">i</span>f <span data-count="88">f</span>ile = "//toplevel//" ||
         <span data-count="88">f</span>ile = "(stdin)" ||
         <span data-count="84">L</span>ist.mem (Filename.basename file) [".ocamlinit"; "topfind"] then
        <span data-count="4">a</span>st
      else
        <span data-count="84">i</span>f not (InstrumentState.is_file file) then
          <span data-count="82">b</span>egin
            (* We have to add this here, before we process the rest of the
               structure, because that may also have structures contained
               there-in, but we'll add the header after processing all of those
               declarations so that we know how many instrumentations there
               are. *)
            InstrumentState.add_file file;
            <span data-count="82">l</span>et rest = <span data-count="82">s</span>uper#structure ast in
            <span data-count="82">l</span>et head = <span data-count="82">f</span>aster file in
            <span data-count="82">h</span>ead :: rest
          end
        else
          <span data-count="2">s</span>uper#structure ast

end
</pre>
      </div>
    </div>
    <div id="footer">Generated by on 2016-02-23 05:50:21 by <a href="https://github.com/rleonid/bisect_ppx">Bisect_ppx</a> 1.0.0</div>
    <script src="coverage.js"></script>
  </body>
</html>
